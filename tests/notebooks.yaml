# Foundry Workshop Notebook Test Configuration
# Run: python -m tests run [--notebook NAME]

settings:
  workspace_root: /workspaces/getting-started-with-foundry
  output_dir: .test-output
  default_timeout_minutes: 30
  parallel_execution: false
  stop_on_first_failure: false

# Resource groups to clean up after tests
cleanup:
  resource_groups:
    - foundry-lz-parent
    - foundry-child-1
    - foundry-contoso
    - foundry-fabrikam
    - foundry-woodgrove
    - foundry-mars-*
    - foundry-memory-spoke
    - foundryiq-lab
    - foundry-builtin-tools
    - foundry-mcp-rg
    - bing-grounding-lab
    - deep-research-lab-rg
    - content-understanding-lab-rg
    - red-teaming-lab-rg
  
  purge_cognitive_services: true

# Notebook test definitions
# Dependencies ensure notebooks run in correct order
notebooks:
  # ═══════════════════════════════════════════════════════════════════════
  # PHASE 1: Foundation (must run first)
  # ═══════════════════════════════════════════════════════════════════════
  
  - name: lab-1a-landing-zone
    path: 01-project-setup/lab-1a-landing-zone/deploy.ipynb
    description: Deploy central Landing Zone with APIM gateway
    timeout_minutes: 20
    resource_group: foundry-lz-parent
    depends_on: []  # No dependencies - runs first
    skip_cells:
      - 3   # az login (manual)
      - 21  # cleanup (commented)

  # ═══════════════════════════════════════════════════════════════════════
  # PHASE 2: Core Spoke Setup (requires Landing Zone)
  # ═══════════════════════════════════════════════════════════════════════

  - name: lab-1b-project-spoke
    path: 01-project-setup/lab-1b-project-spoke/deploy.ipynb
    description: Deploy project spoke connected to Landing Zone
    timeout_minutes: 10
    resource_group: foundry-child-1
    depends_on: [lab-1a-landing-zone]  # Needs .env from 1a
    skip_cells:
      - 17  # cleanup (commented)
      - 18  # cleanup (commented)

  - name: lab-1c-model-router
    path: 01-project-setup/lab-1c-model-router/deploy.ipynb
    description: Add Model Router to Landing Zone
    timeout_minutes: 10
    resource_group: foundry-lz-parent
    depends_on: [lab-1b-project-spoke]  # Updates spoke connection from 1b
    skip_cells:
      - 17  # cleanup (commented)

  # ═══════════════════════════════════════════════════════════════════════
  # PHASE 3: Inference Labs (requires Landing Zone)
  # ═══════════════════════════════════════════════════════════════════════

  - name: lab-2a-team-spokes
    path: 02-inference/lab-2a-team-spokes/deploy.ipynb
    description: Deploy team spokes with model access
    timeout_minutes: 15
    depends_on: [lab-1c-model-router]  # Needs model-router from 1c

  - name: lab-2b-direct-apim
    path: 02-inference/lab-2b-direct-apim/deploy.ipynb
    description: Direct APIM access without Foundry spoke
    timeout_minutes: 10
    depends_on: [lab-1a-landing-zone]  # Only needs APIM from 1a

  # ═══════════════════════════════════════════════════════════════════════
  # PHASE 4: Governance (requires Landing Zone)
  # ═══════════════════════════════════════════════════════════════════════

  - name: lab-3-governance
    path: 03-governance-policy/deploy.ipynb
    description: Configure governance policies
    timeout_minutes: 10
    depends_on: [lab-1a-landing-zone]  # Needs hub account from 1a

  # ═══════════════════════════════════════════════════════════════════════
  # PHASE 5: Agent Features (requires Landing Zone)
  # ═══════════════════════════════════════════════════════════════════════

  - name: lab-4-hosted-agents
    path: 04-hosted-agents/main.ipynb
    description: Deploy hosted agents with ACR
    timeout_minutes: 25
    depends_on: [lab-1a-landing-zone]  # Needs APIM credentials from 1a

  - name: lab-5-agent-memory
    path: 05-agent-memory/deploy.ipynb
    description: Agent memory and state management
    timeout_minutes: 15
    resource_group: foundry-memory-spoke
    depends_on: [lab-1a-landing-zone]  # Needs APIM from 1a

  # ═══════════════════════════════════════════════════════════════════════
  # PHASE 6: Knowledge & Tools (requires Landing Zone)
  # ═══════════════════════════════════════════════════════════════════════

  # DISABLED: Takes too long to test (555s+)
  # - name: lab-6-foundry-iq
  #   path: 06-foundry-iq/main.ipynb
  #   description: Knowledge retrieval with Foundry IQ
  #   timeout_minutes: 15
  #   resource_group: foundryiq-lab
  #   depends_on: [lab-1a-landing-zone]  # Needs APIM from 1a

  # DISABLED: Infrastructure deployment issues
  # - name: lab-7a-builtin-tools
  #   path: 07-tool-catalog/lab-7a-builtin-tools/main.ipynb
  #   description: Built-in tools (Code Interpreter, File Search)
  #   timeout_minutes: 15
  #   resource_group: foundry-builtin-tools
  #   depends_on: []  # Standalone - deploys own resources

  - name: lab-7c-bing-grounding
    path: 07-tool-catalog/lab-7c-bing-grounding/deploy.ipynb
    description: Web search grounding for agents
    timeout_minutes: 15
    resource_group: bing-grounding-lab
    depends_on: [lab-1a-landing-zone]  # Needs APIM from 1a

  # ═══════════════════════════════════════════════════════════════════════
  # PHASE 7: Advanced Features (requires Landing Zone)
  # ═══════════════════════════════════════════════════════════════════════

  # DISABLED: Missing bicep module files (deep-research-model.bicep, apim-responses-api.bicep)
  # - name: lab-8-deep-research
  #   path: 08-deep-research/deploy.ipynb
  #   description: Deep research with o3-deep-research model
  #   timeout_minutes: 20
  #   resource_group: deep-research-lab-rg
  #   depends_on: [lab-1a-landing-zone]  # Deploys to hub from 1a

  # DISABLED: Takes too long to test (900s+)
  # - name: lab-9-content-understanding
  #   path: 09-content-understanding/deploy.ipynb
  #   description: Document and video analysis
  #   timeout_minutes: 15
  #   resource_group: content-understanding-lab-rg
  #   depends_on: []  # Standalone - deploys own AI Services

  # ═══════════════════════════════════════════════════════════════════════
  # PHASE 8: Workflows & Orchestration (requires Landing Zone + Spoke)
  # ═══════════════════════════════════════════════════════════════════════

  - name: lab-12-agent-workflow
    path: 12-agent-workflow/main.ipynb
    description: Multi-agent workflow orchestration
    timeout_minutes: 15
    depends_on: [lab-1b-project-spoke]  # Needs project spoke from 1b

  # ═══════════════════════════════════════════════════════════════════════
  # PHASE 9: Observability & Testing (requires Landing Zone)
  # ═══════════════════════════════════════════════════════════════════════

  - name: lab-15-observability
    path: 15-observability/main.ipynb
    description: Tracing and debugging agents
    timeout_minutes: 15
    depends_on: [lab-1b-project-spoke]  # Needs project spoke from 1b

  # DISABLED: Depends on SpaceExpert agent created by lab-6-foundry-iq (which is disabled)
  # - name: lab-16-evaluation
  #   path: 16-evaluation/main.ipynb
  #   description: Agent evaluation framework
  #   timeout_minutes: 15
  #   depends_on: [lab-1b-project-spoke]  # Needs project spoke from 1b

  # DISABLED: Requires azure-ai-evaluation[redteam] extra which has complex dependencies
  # - name: lab-16-red-teaming
  #   path: 16-red-teaming/main.ipynb
  #   description: Security testing with red teaming
  #   timeout_minutes: 15
  #   resource_group: red-teaming-lab-rg
  #   depends_on: [lab-1a-landing-zone]  # Needs hub from 1a

# ─────────────────────────────────────────────────────────────────────────
# Excluded notebooks (require manual steps or special environments)
# ─────────────────────────────────────────────────────────────────────────
# - 00-image-generation: Standalone demo, no infrastructure
# - 10-agent-registry: Portal walkthrough only
# - 11-agent-365: Requires M365 admin portal, device code auth
# - 13-human-in-loop: Feature not yet released
# - 14-m365-integration: Documentation only
# - 14b-m365-foundry-publish: Requires Teams portal steps
# - 17-foundry-local: Requires local Foundry installation
# - 17b-fine-tuning: ACA serverless GPU, long runtime
